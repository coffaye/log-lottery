import{u as e}from"./chunk-usuw4WvT.js";import{_ as a}from"./chunk-BOxwbQEi.js";import{i as t,u as l,b as n,l as s,d as o}from"./chunk-DVh1S322.js";import{K as r,r as i,V as d,P as p,ab as u,T as c,R as m,al as b,am as g,ad as h,ai as f,u as v,ag as y,ah as w,p as k,x,Z as P,Q as D,F as j,i as T}from"./chunk-F_c2qvy9.js";import{_}from"./chunk-NAUKeqGn.js";import{s as C}from"./chunk-BQPiyGN6.js";import{d as A}from"./chunk-hwbcIzkA.js";import{u as O,w as R}from"./chunk-BtghHq-e.js";import{r as L,a as N}from"./chunk-DsM932Ci.js";import{v as z}from"./chunk-CC7_aw_8.js";import"./chunk-lIqasEa_.js";import"./chunk-DHt_odDz.js";import"./chunk-B6DJkpsW.js";import"./chunk-BQCeX3nN.js";import"./chunk-CM4-pTv8.js";import"./chunk-DfvjaFaT.js";import"./chunk-Cd-Bo5_X.js";import"./chunk-CNqBaGtl.js";import"./chunk-BBdGfzn7.js";import"./chunk-C-xSI_mL.js";import"./chunk-C6xTB_Ct.js";import"./chunk-7CVvifAO.js";import"./chunk-CLSYnucs.js";import"./chunk-BenQXQHa.js";import"./chunk-Dcd9jy7q.js";import"./chunk-DezxjiP8.js";import"./chunk-BrzZcLsH.js";const W={class:"drawer drawer-end h-0 w-0"},S={class:"drawer-content w-0 h-0 absolute"},F={class:"drawer-side"},U={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},V=r({__name:"index",setup(e,{expose:a}){const t=i(null),l=i(!1);return a({showDrawer:function(){t.value?.click(),l.value=!0},closeDrawer:function(){t.value?.click(),l.value=!1}}),(e,a)=>(p(),d("div",W,[a[1]||(a[1]=u("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),u("div",S,[u("label",{ref_key:"drawerTriggerRef",ref:t,for:"my-drawer-1"},null,512)]),u("div",F,[a[0]||(a[0]=u("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),l.value?(p(),d("div",U,[m(e.$slots,"content")])):c("",!0)])]))}}),$={class:"fieldset"},E={class:"label"},J=["placeholder"],M={class:"fieldset"},q={class:"label",required:""},I=["placeholder"],Q={class:"validator-hint hidden"},G={class:"fieldset"},H={class:"label"},K=["placeholder"],X={class:"fieldset"},Y={class:"label"},Z=["placeholder"],B={class:"fieldset"},ee={class:"label"},ae=["placeholder"],te={class:"btn btn-neutral mt-4",type:"submit"},le=r({__name:"SinglePerson",props:b({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(a){const{t:t}=e(),l=g(a,"singlePersonData");return(e,n)=>(p(),d("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:n[6]||(n[6]=e=>a.addOnePerson(a.addOnePersonDrawerRef,e))},[u("label",$,[u("span",E,f(v(t)("table.number")),1),h(u("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>l.value.uid=e),type:"text",class:"input validator",placeholder:v(t)("table.number")},null,8,J),[[y,l.value.uid]])]),u("fieldset",M,[u("label",q,[w(f(v(t)("table.name")),1),n[7]||(n[7]=u("span",{class:"text-red-500"},"*",-1))]),h(u("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>l.value.name=e),type:"text",class:"input validator",placeholder:v(t)("table.name"),required:"",minlength:"1"},null,8,I),[[y,l.value.name]]),u("p",Q,f(v(t)("error.personNameEmpty")),1)]),u("label",G,[u("span",H,f(v(t)("table.department")),1),h(u("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>l.value.department=e),type:"text",class:"input validator",placeholder:v(t)("table.department")},null,8,K),[[y,l.value.department]])]),u("label",X,[u("span",Y,f(v(t)("table.avatar")),1),h(u("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>l.value.avatar=e),type:"text",class:"input validator",placeholder:v(t)("table.avatar")},null,8,Z),[[y,l.value.avatar]])]),u("label",B,[u("span",ee,f(v(t)("table.identity")),1),h(u("input",{"onUpdate:modelValue":n[4]||(n[4]=e=>l.value.identity=e),type:"text",class:"input validator",placeholder:v(t)("table.identity")},null,8,ae),[[y,l.value.identity]])]),u("button",te,f(v(t)("button.confirm")),1),u("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:n[5]||(n[5]=e=>a.addOnePersonDrawerRef.closeDrawer())},f(v(t)("button.cancel")),1)],32))}});function ne(e){return new Worker("/log-lottery/assets/importExcel.worker-CWYp5aq3.js",{name:e?.name})}function se({exportInputFileRef:a}){const{t:o}=e(),r="/log-lottery/".replace("./","/"),d=A.useToast(),p=new ne,u=x(s),c=l().personConfig,{getAllPersonList:m,getAlreadyPersonList:b}=C(c),g=(h={handleDeletePerson:function(e){c.deletePerson(e)}},[{label:t.global.t("data.number"),props:"uid"},{label:t.global.t("data.name"),props:"name"},{label:t.global.t("data.department"),props:"department"},{label:t.global.t("data.avatar"),props:"avatar",formatValue:e=>e.avatar?`<img src="${e.avatar}" alt="avatar" style="width: 50px; height: 50px;"/>`:"-"},{label:t.global.t("data.identity"),props:"identity"},{label:t.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?t.global.t("data.yes"):t.global.t("data.no")},{label:t.global.t("data.operation"),actions:[{label:t.global.t("data.delete"),type:"btn-error",onClick:e=>{h.handleDeletePerson(e)}}]}]);var h;const f=i(!1),v=i({uid:"",name:"",department:"",avatar:"",identity:""});async function y(){if("zhCn"===t.global.locale.value){return await N(`${r}人口登记表-zhCn.xlsx`)}return await N(`${r}personListTemplate-en.xlsx`)}async function w(e){var a;u?.show(),y(),a={type:"start",data:e,templateData:await y()},p&&p.postMessage(a)}return{resetData:function(){c.resetAlreadyPerson()},deleteAll:function(){c.deleteAllPerson()},handleFileChange:async function(e){p&&(p.onmessage=e=>{if("done"===e.data.type&&(c.resetPerson(),c.addNotPersonList(e.data.data),d.open({message:o("error.importSuccess"),type:"success",position:"top-right"}),a.value&&(a.value.value="")),"error"===e.data.type){if("not right template"===e.data.message)return void d.open({message:o("error.excelFileError"),type:"error",position:"top-right"});d.open({message:e.data.message||o("error.importFail"),type:"error",position:"top-right"})}u?.hide()}),w(await L(e.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(m.value));for(let l=0;l<e.length;l++)delete e[l].x,delete e[l].y,delete e[l].id,delete e[l].createTime,delete e[l].updateTime,delete e[l].prizeId,e[l].isWin?e[l].isWin=t.global.t("data.yes"):e[l].isWin=t.global.t("data.no"),e[l].prizeTime=e[l].prizeTime.join(","),e[l].prizeName=e[l].prizeName.join(",");let a=JSON.stringify(e);if(a=a.replaceAll(/uid/g,t.global.t("data.number")).replaceAll(/isWin/g,t.global.t("data.isWin")).replaceAll(/department/g,t.global.t("data.department")).replaceAll(/name/g,t.global.t("data.name")).replaceAll(/identity/g,t.global.t("data.identity")).replaceAll(/prizeName/g,t.global.t("data.prizeName")).replaceAll(/prizeTime/g,t.global.t("data.prizeTime")),e=JSON.parse(a),e.length>0){const a=O.json_to_sheet(e),t=O.book_new();O.book_append_sheet(t,a,"Sheet1"),R(t,"data.xlsx")}},alreadyPersonList:b,allPersonList:m,tableColumnList:g,addOnePerson:function(e,a){a.preventDefault();const t=n([k(v.value)]);t[0].id=z(),c.addOnePerson(t),e.closeDrawer(),v.value={}},addPersonModalVisible:f,singlePersonData:v,downloadTemplate:function(){const e=t.global.t("data.xlsxName");fetch(`${r}${e}`).then(e=>e.blob()).then(a=>{const t=window.URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=e,l.click(),d.open({message:o("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const oe={class:"min-w-1000px"},re={class:"flex gap-3"},ie=["data-tip"],de={class:""},pe={for:"explore"},ue=["data-tip"],ce={class:"btn btn-primary btn-sm"},me=r({__name:"index",setup(t){const l=i(),n=i(),s=i(),r=i(),{resetData:c,deleteAll:m,handleFileChange:b,exportData:g,addOnePerson:h,singlePersonData:y,alreadyPersonList:w,allPersonList:k,tableColumnList:x,downloadTemplate:C}=se({exportInputFileRef:s}),{t:A}=e();return(e,t)=>(p(),d(j,null,[P(o,{ref_key:"resetDataDialogRef",ref:l,title:v(A)("dialog.titleTip"),desc:v(A)("dialog.dialogResetWinner"),"submit-func":v(c)},null,8,["title","desc","submit-func"]),P(o,{ref_key:"delAllDataDialogRef",ref:n,title:v(A)("dialog.titleTip"),desc:v(A)("dialog.dialogDelAllPerson"),"submit-func":v(m)},null,8,["title","desc","submit-func"]),P(V,{ref_key:"addOnePersonDrawerRef",ref:r},{content:D(()=>[P(le,{"single-person-data":v(y),"onUpdate:singlePersonData":t[0]||(t[0]=e=>T(y)?y.value=e:null),"add-one-person-drawer-ref":r.value,"add-one-person":v(h)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),u("div",oe,[P(_,{title:v(A)("viewTitle.personManagement")},{buttons:D(()=>[u("div",re,[u("button",{class:"btn btn-error btn-sm",onClick:t[1]||(t[1]=e=>n.value.showDialog())},f(v(A)("button.allDelete")),1),u("div",{class:"tooltip tooltip-bottom","data-tip":v(A)("tooltip.downloadTemplateTip")},[u("button",{class:"no-underline btn btn-secondary btn-sm",onClick:t[2]||(t[2]=(...e)=>v(C)&&v(C)(...e))},f(v(A)("button.downloadTemplate")),1)],8,ie),u("div",de,[u("label",pe,[u("div",{class:"tooltip tooltip-bottom","data-tip":v(A)("tooltip.uploadExcelTip")},[u("input",{id:"explore",ref_key:"exportInputFileRef",ref:s,type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:t[3]||(t[3]=(...e)=>v(b)&&v(b)(...e))},null,544),u("span",ce,f(v(A)("button.importData")),1)],8,ue)])]),u("button",{class:"btn btn-error btn-sm",onClick:t[4]||(t[4]=e=>l.value.showDialog())},f(v(A)("button.resetData")),1),u("button",{class:"btn btn-accent btn-sm",onClick:t[5]||(t[5]=(...e)=>v(g)&&v(g)(...e))},f(v(A)("button.exportResult")),1),u("button",{class:"btn btn-neutral btn-sm",onClick:t[6]||(t[6]=e=>r.value.showDrawer())},f(v(A)("button.add")),1),u("div",null,[u("span",null,f(v(A)("table.luckyPeopleNumber"))+":",1),u("span",null,f(v(w).length),1),t[7]||(t[7]=u("span",null," / ",-1)),u("span",null,f(v(k).length),1)])])]),_:1},8,["title"]),P(a,{"table-columns":v(x),data:v(k)},null,8,["table-columns","data"])])],64))}});export{me as default};
